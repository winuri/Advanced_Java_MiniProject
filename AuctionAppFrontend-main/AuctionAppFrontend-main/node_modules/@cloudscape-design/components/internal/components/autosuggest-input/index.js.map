{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../src/internal/components/autosuggest-input/index.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\n\nimport React, { Ref, useRef, useState, useImperativeHandle, useEffect } from 'react';\n\nimport Dropdown from '../dropdown';\n\nimport { FormFieldValidationControlProps, useFormFieldContext } from '../../context/form-field-context';\nimport { BaseComponentProps, getBaseProps } from '../../base-component';\nimport { BaseKeyDetail, fireCancelableEvent, fireNonCancelableEvent, NonCancelableEventHandler } from '../../events';\nimport InternalInput from '../../../input/internal';\nimport { BaseChangeDetail, BaseInputProps, InputAutoCorrect, InputKeyEvents } from '../../../input/interfaces';\nimport { AutosuggestProps } from '../../../autosuggest/interfaces';\nimport { ExpandToViewport } from '../dropdown/interfaces';\nimport { InternalBaseComponentProps } from '../../hooks/use-base-component';\nimport { KeyCode } from '../../keycode';\nimport styles from './styles.css.js';\nimport clsx from 'clsx';\n\nexport interface AutosuggestInputProps\n  extends BaseComponentProps,\n    BaseInputProps,\n    InputAutoCorrect,\n    InputKeyEvents,\n    FormFieldValidationControlProps,\n    ExpandToViewport,\n    InternalBaseComponentProps {\n  ariaControls?: string;\n  ariaActivedescendant?: string;\n  dropdownExpanded?: boolean;\n  dropdownContentKey?: string;\n  dropdownContentFocusable?: boolean;\n  dropdownContent?: React.ReactNode;\n  dropdownFooter?: React.ReactNode;\n  dropdownWidth?: number;\n  loopFocus?: boolean;\n  onCloseDropdown?: NonCancelableEventHandler<null>;\n  onDelayedInput?: NonCancelableEventHandler<BaseChangeDetail>;\n  onPressArrowDown?: () => void;\n  onPressArrowUp?: () => void;\n  onPressEnter?: () => boolean;\n}\n\nexport interface AutosuggestInputFocusOptions {\n  preventDropdown?: boolean;\n}\n\nexport interface AutosuggestInputRef extends AutosuggestProps.Ref {\n  focus(options?: AutosuggestInputFocusOptions): void;\n  open(): void;\n  close(): void;\n}\n\nconst AutosuggestInput = React.forwardRef(\n  (\n    {\n      value,\n      onChange,\n      onBlur,\n      onFocus,\n      onKeyUp,\n      onKeyDown,\n      name,\n      placeholder,\n      disabled,\n      readOnly,\n      autoFocus,\n      ariaLabel,\n      ariaRequired,\n      disableBrowserAutocorrect = false,\n      expandToViewport,\n      ariaControls,\n      ariaActivedescendant,\n      dropdownExpanded = true,\n      dropdownContentKey,\n      dropdownContentFocusable = false,\n      dropdownContent = null,\n      dropdownFooter = null,\n      dropdownWidth,\n      loopFocus,\n      onCloseDropdown,\n      onDelayedInput,\n      onPressArrowDown,\n      onPressArrowUp,\n      onPressEnter,\n      __internalRootRef,\n      ...restProps\n    }: AutosuggestInputProps,\n    ref: Ref<AutosuggestInputRef>\n  ) => {\n    const baseProps = getBaseProps(restProps);\n    const formFieldContext = useFormFieldContext(restProps);\n\n    const inputRef = useRef<HTMLInputElement>(null);\n    const dropdownContentRef = useRef<HTMLDivElement>(null);\n    const dropdownFooterRef = useRef<HTMLDivElement>(null);\n    const preventOpenOnFocusRef = useRef(false);\n    const preventCloseOnBlurRef = useRef(false);\n\n    const [open, setOpen] = useState(false);\n\n    const openDropdown = () => !readOnly && setOpen(true);\n\n    const closeDropdown = () => {\n      setOpen(false);\n      fireNonCancelableEvent(onCloseDropdown, null);\n    };\n\n    useImperativeHandle(ref, () => ({\n      focus(options?: AutosuggestInputFocusOptions) {\n        if (options?.preventDropdown) {\n          preventOpenOnFocusRef.current = true;\n        }\n        inputRef.current?.focus();\n      },\n      select() {\n        inputRef.current?.select();\n      },\n      open: openDropdown,\n      close: closeDropdown,\n    }));\n\n    const handleBlur = () => {\n      if (!preventCloseOnBlurRef.current) {\n        closeDropdown();\n        fireNonCancelableEvent(onBlur, null);\n      }\n    };\n\n    const handleFocus = () => {\n      if (!preventOpenOnFocusRef.current) {\n        openDropdown();\n        fireNonCancelableEvent(onFocus, null);\n      }\n      preventOpenOnFocusRef.current = false;\n    };\n\n    const handleKeyDown = (e: CustomEvent<BaseKeyDetail>) => {\n      switch (e.detail.keyCode) {\n        case KeyCode.down: {\n          onPressArrowDown?.();\n          openDropdown();\n          e.preventDefault();\n          break;\n        }\n        case KeyCode.up: {\n          onPressArrowUp?.();\n          openDropdown();\n          e.preventDefault();\n          break;\n        }\n        case KeyCode.enter: {\n          if (open) {\n            if (!onPressEnter?.()) {\n              closeDropdown();\n            }\n            e.preventDefault();\n          }\n          fireCancelableEvent(onKeyDown, e.detail);\n          break;\n        }\n        case KeyCode.escape: {\n          if (open) {\n            closeDropdown();\n          } else if (value) {\n            fireNonCancelableEvent(onChange, { value: '' });\n          }\n          e.preventDefault();\n          fireCancelableEvent(onKeyDown, e.detail);\n          break;\n        }\n        default: {\n          fireCancelableEvent(onKeyDown, e.detail);\n        }\n      }\n    };\n\n    const handleChange = (value: string) => {\n      openDropdown();\n      fireNonCancelableEvent(onChange, { value });\n    };\n\n    const handleDelayedInput = (value: string) => {\n      fireNonCancelableEvent(onDelayedInput, { value });\n    };\n\n    const handleDropdownMouseDown: React.MouseEventHandler = event => {\n      // Prevent currently focused element from losing focus.\n      if (!dropdownContentFocusable) {\n        event.preventDefault();\n      }\n      // Prevent closing dropdown on click inside.\n      else {\n        preventCloseOnBlurRef.current = true;\n        requestAnimationFrame(() => {\n          preventCloseOnBlurRef.current = false;\n        });\n      }\n    };\n\n    const expanded = open && dropdownExpanded;\n    const nativeAttributes = {\n      name,\n      placeholder,\n      autoFocus,\n      onClick: openDropdown,\n      role: 'combobox',\n      'aria-autocomplete': 'list',\n      'aria-expanded': expanded,\n      'aria-controls': open ? ariaControls : undefined,\n      // 'aria-owns' needed for safari+vo to announce activedescendant content\n      'aria-owns': open ? ariaControls : undefined,\n      'aria-label': ariaLabel,\n      'aria-activedescendant': ariaActivedescendant,\n    };\n\n    // Closes dropdown when outside click is detected.\n    // Similar to the internal dropdown implementation but includes the target as well.\n    useEffect(() => {\n      if (!open) {\n        return;\n      }\n\n      const clickListener = (event: MouseEvent) => {\n        if (\n          !inputRef.current?.contains(event.target as Node) &&\n          !dropdownContentRef.current?.contains(event.target as Node) &&\n          !dropdownFooterRef.current?.contains(event.target as Node)\n        ) {\n          closeDropdown();\n        }\n      };\n\n      window.addEventListener('mousedown', clickListener);\n\n      return () => {\n        window.removeEventListener('mousedown', clickListener);\n      };\n\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [open]);\n\n    return (\n      <div {...baseProps} className={clsx(baseProps.className, styles.root)} ref={__internalRootRef}>\n        <Dropdown\n          minWidth={dropdownWidth}\n          stretchWidth={!dropdownWidth}\n          contentKey={dropdownContentKey}\n          onFocus={handleFocus}\n          onBlur={handleBlur}\n          trigger={\n            <InternalInput\n              type=\"visualSearch\"\n              value={value}\n              onChange={event => handleChange(event.detail.value)}\n              __onDelayedInput={event => handleDelayedInput(event.detail.value)}\n              onKeyDown={handleKeyDown}\n              onKeyUp={onKeyUp}\n              disabled={disabled}\n              disableBrowserAutocorrect={disableBrowserAutocorrect}\n              readOnly={readOnly}\n              ariaRequired={ariaRequired}\n              ref={inputRef}\n              autoComplete={false}\n              __nativeAttributes={nativeAttributes}\n              {...formFieldContext}\n            />\n          }\n          onMouseDown={handleDropdownMouseDown}\n          open={open}\n          footer={\n            dropdownFooterRef && (\n              <div ref={dropdownFooterRef} className={styles['dropdown-footer']}>\n                {dropdownFooter}\n              </div>\n            )\n          }\n          expandToViewport={expandToViewport}\n          loopFocus={loopFocus}\n        >\n          {open && dropdownContent ? (\n            <div ref={dropdownContentRef} className={styles['dropdown-content']}>\n              {dropdownContent}\n            </div>\n          ) : null}\n        </Dropdown>\n      </div>\n    );\n  }\n);\n\nexport default AutosuggestInput;\n"]}